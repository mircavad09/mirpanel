<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mirpanel.com — Admin</title>
  <style>
    :root{
      --bg:#070707;--txt:#fff;--mut:rgba(255,255,255,.65);
      --bd:rgba(255,255,255,.10);--p:rgba(255,255,255,.04);
      --acc:#00ff99;--acc2:#6a5cff;--r:16px;--sh:0 18px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 480px at 12% -10%, rgba(0,255,153,.16), transparent 60%),
        radial-gradient(900px 520px at 92% 0%, rgba(106,92,255,.11), transparent 60%),
        var(--bg);
      color:var(--txt);
    }
    .wrap{max-width:1180px;margin:0 auto;padding:14px}
    .top{
      display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;
      padding:12px;border:1px solid var(--bd);border-radius:18px;
      background:linear-gradient(180deg,var(--p),rgba(255,255,255,.02));
      box-shadow:var(--sh);
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logoPrev{
      width:44px;height:44px;border-radius:16px;object-fit:cover;
      border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.03);
      box-shadow:0 0 30px rgba(0,255,153,.10);
    }
    h1{margin:0;font-size:16px}
    .mut{color:var(--mut);font-size:12px;line-height:1.35}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    @media(max-width:900px){.row{grid-template-columns:1fr}}
    .box{
      border:1px solid var(--bd);border-radius:18px;
      background:linear-gradient(180deg,var(--p),rgba(255,255,255,.02));
      padding:12px;
      box-shadow:var(--sh);
    }
    .box h2{margin:0 0 8px 0;font-size:14px}
    label{display:block;font-size:12px;color:var(--mut);margin:8px 0 6px}
    input,textarea,select{
      width:100%;
      padding:10px 12px;border-radius:14px;
      border:1px solid var(--bd);
      background:rgba(255,255,255,.03);
      color:var(--txt);
      outline:none;
    }
    textarea{min-height:84px;resize:vertical}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{
      cursor:pointer;
      padding:10px 12px;border-radius:14px;
      border:1px solid var(--bd);
      background:rgba(255,255,255,.04);
      color:var(--txt);
      font-weight:900;
    }
    .primary{
      border-color:rgba(0,255,153,.30);
      background:linear-gradient(135deg, rgba(0,255,153,.95), rgba(0,255,153,.72));
      color:#000;
    }
    .danger{
      border-color:rgba(255,80,80,.35);
      background:rgba(255,80,80,.12);
      color:#fff;
    }
    .mini{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .hr{height:1px;background:rgba(255,255,255,.08);margin:12px 0}
    .small{font-size:12px;color:var(--mut);line-height:1.45}

    .list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
    .item{
      border:1px solid var(--bd);
      border-radius:16px;
      background:rgba(255,255,255,.03);
      padding:10px;
      display:grid;
      grid-template-columns: 1fr 200px;
      gap:10px;
      align-items:start;
    }
    @media(max-width:900px){.item{grid-template-columns:1fr}}
    .thumb{
      width:70px;height:48px;object-fit:cover;border-radius:12px;
      border:1px solid var(--bd);background:#111;
    }
    .k{font-size:12px;color:var(--mut)}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:900px){.split{grid-template-columns:1fr}}

    /* PIN gate */
    .pin{
      position:fixed;inset:0;background:rgba(0,0,0,.72);
      display:flex;align-items:center;justify-content:center;padding:14px;
    }
    .pinCard{
      width:min(520px,100%);
      border:1px solid var(--bd);border-radius:20px;
      background:linear-gradient(180deg,var(--p),rgba(255,255,255,.02));
      padding:14px;
      box-shadow:var(--sh);
    }
  </style>
</head>

<body>
<!-- PIN GATE -->
<div class="pin" id="pinGate">
  <div class="pinCard">
    <h1>Admin giriş (Mirpanel.com)</h1>
    <div class="mut" style="margin-top:6px">
      4 rəqəmli kod. İlk dəfə daxil olanda öz kodunu təyin edirsən.
      Bu kod yalnız sənin brauzerdə saxlanır.
    </div>

    <label>Kod</label>
    <input id="pin" inputmode="numeric" maxlength="4" placeholder="****" />

    <div class="btns" style="margin-top:10px">
      <button class="primary" id="pinEnter">Daxil ol</button>
      <button class="danger" id="pinReset">Kod sıfırla</button>
    </div>
  </div>
</div>

<!-- APP -->
<div class="wrap" style="display:none" id="app">
  <div class="top">
    <div class="brand">
      <img id="topLogo" class="logoPrev" alt="logo" />
      <div>
        <h1>Mirpanel.com — Admin Panel</h1>
        <div class="mut">Dəyişiklik et → Export services.json → GitHub-da services.json-ın üstünə qoy → Commit.</div>
      </div>
    </div>

    <div class="btns">
      <button id="loadFromSite">Saytdan oxu</button>
      <button id="saveDraft">Yadda saxla</button>
      <button class="primary" id="downloadJson">Export services.json</button>
    </div>
  </div>

  <div class="row">
    <!-- GENERAL + SEO + UI -->
    <div class="box">
      <h2>Ümumi</h2>
      <label>Brand adı</label>
      <input id="brand" placeholder="Mirpanel.com" />

      <label>WhatsApp link</label>
      <input id="wa" placeholder="https://wa.me/994..." />

      <div class="hr"></div>

      <h2>Sayt Loqosu (Header)</h2>
      <label>Logo URL</label>
      <input id="ui_logo" placeholder="https://.../logo.png" />
      <label>Logo upload</label>
      <input type="file" id="ui_logo_file" accept="image/*" />
      <div class="small">Tövsiyə: 512×512 PNG/WebP (transparent). URL də olar, upload da.</div>

      <div class="hr"></div>

      <h2>SEO</h2>
      <label>Title</label>
      <input id="seo_title" />

      <label>Description</label>
      <textarea id="seo_desc"></textarea>

      <div class="split">
        <div>
          <label>Canonical</label>
          <input id="seo_canon" placeholder="https://mirpanel.com/" />
        </div>
        <div>
          <label>Theme color</label>
          <input id="seo_theme" placeholder="#070707" />
        </div>
      </div>

      <div class="split">
        <div>
          <label>Favicon URL</label>
          <input id="seo_favicon" placeholder="https://.../favicon.png" />
          <label>Favicon upload</label>
          <input type="file" id="favicon_file" accept="image/*" />
        </div>
        <div>
          <label>OG image URL</label>
          <input id="seo_og" placeholder="https://.../og.jpg" />
          <label>OG image upload</label>
          <input type="file" id="og_file" accept="image/*" />
        </div>
      </div>

      <div class="small">
        Upload edəndə şəkil dataURL kimi services.json-a yazılır.
        İstəsən ayrıca fayl kimi repo-da saxlayıb URL verə bilərsən.
      </div>
    </div>

    <!-- CATEGORIES -->
    <div class="box">
      <h2>Kateqoriyalar</h2>

      <div class="split">
        <div>
          <label>Yeni kateqoriya key</label>
          <input id="cat_key" placeholder="instagram" />
        </div>
        <div>
          <label>Yeni kateqoriya label</label>
          <input id="cat_label" placeholder="Instagram" />
        </div>
      </div>

      <div class="btns" style="margin-top:10px">
        <button class="primary" id="addCat">Kateqoriya əlavə et</button>
      </div>

      <div class="list" id="catList"></div>
    </div>
  </div>

  <!-- SERVICES -->
  <div class="box" style="margin-top:12px">
    <h2>Xidmətlər</h2>

    <div class="split">
      <div>
        <label>Kateqoriya</label>
        <select id="s_cat"></select>
      </div>
      <div>
        <label>ID (unikal)</label>
        <input id="s_id" placeholder="ig-real-follow-1000" />
      </div>
    </div>

    <label>Ad</label>
    <input id="s_title" placeholder="Instagram Real Takibçi" />

    <div class="split">
      <div>
        <label>Miqdar</label>
        <input id="s_amount" placeholder="1000 Ədəd" />
      </div>
      <div>
        <label>Valyuta</label>
        <input id="s_cur" value="AZN" />
      </div>
    </div>

    <div class="split">
      <div>
        <label>Qiymət</label>
        <input id="s_price" inputmode="decimal" placeholder="5" />
      </div>
      <div>
        <label>Köhnə qiymət (istəyə görə)</label>
        <input id="s_old" inputmode="decimal" placeholder="7" />
      </div>
    </div>

    <label>Açıqlama</label>
    <textarea id="s_desc"></textarea>

    <div class="split">
      <div>
        <label>Zəmanət</label>
        <input id="s_gua" placeholder="Ömür boyu zəmanət" />
      </div>
      <div>
        <label>İcra vaxtı</label>
        <input id="s_speed" placeholder="0–2 saat" />
      </div>
    </div>

    <label>Şərt/Qeyd</label>
    <textarea id="s_note"></textarea>

    <label>Şəkil URL</label>
    <input id="s_img" placeholder="https://..." />

    <label>Şəkil upload</label>
    <input type="file" id="s_img_file" accept="image/*" />

    <div class="btns" style="margin-top:10px">
      <button class="primary" id="addService">Xidmət əlavə et</button>
      <button class="danger" id="clearForm">Formu təmizlə</button>
    </div>

    <div class="hr"></div>
    <div class="small">Dəyişiklikləri etdikdən sonra mütləq Export edib GitHub-da services.json-ın üstünə qoy.</div>

    <div class="list" id="serviceList"></div>
  </div>
</div>

<script>
  const PIN_KEY = "mp_admin_pin_v2";
  const DRAFT_KEY = "mp_admin_draft_v2";
  const $ = (id)=> document.getElementById(id);

  let DB = null;

  function esc(s){
    return String(s ?? "").replace(/[<>&"]/g, c => ({'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;'}[c]));
  }

  function defaultDB(){
    return {
      brand:"Mirpanel.com",
      whatsapp:"https://wa.me/994559602617",
      seo:{
        title:"Mirpanel.com — Premium & SMM Xidmətləri",
        description:"Premium və SMM xidmətləri. Qeydiyyat yoxdur. Sifariş yalnız WhatsApp üzərindən qəbul olunur.",
        site_name:"Mirpanel.com",
        canonical: location.origin + "/",
        theme_color:"#070707",
        twitter_card:"summary_large_image",
        favicon:"",
        og_image:""
      },
      ui:{ logo:"" },
      categories: [
        { "key": "instagram", "label": "Instagram" },
        { "key": "tiktok", "label": "TikTok" },
        { "key": "youtube", "label": "YouTube" },
        { "key": "facebook", "label": "Facebook" },
        { "key": "telegram", "label": "Telegram" },
        { "key": "twitter", "label": "Twitter (X)" },
        { "key": "netflix premium", "label": "Netflix Premium" },
        { "key": "capcut premium", "label": "CapCut Premium" },
        { "key": "chatgpt premium", "label": "ChatGPT Premium" }
      ],
      services:[]
    };
  }

  function gate(){
    $("pinEnter").onclick = ()=>{
      const v = ($("pin").value || "").trim();
      if(v.length !== 4) return alert("4 rəqəm yaz.");
      const saved = localStorage.getItem(PIN_KEY);
      if(!saved){
        localStorage.setItem(PIN_KEY, v);
        openApp();
        return;
      }
      if(saved !== v) return alert("Kod yanlışdır.");
      openApp();
    };

    $("pinReset").onclick = ()=>{
      localStorage.removeItem(PIN_KEY);
      alert("Kod sıfırlandı. İndi yenidən 4 rəqəm təyin edəcəksən.");
    };
  }

  function openApp(){
    $("pinGate").style.display="none";
    $("app").style.display="block";
    boot();
  }

  async function boot(){
    const draft = localStorage.getItem(DRAFT_KEY);
    if(draft){
      try{ DB = JSON.parse(draft); }catch(e){}
    }
    if(!DB) DB = defaultDB();
    normalizeDB();
    fillUI();
    bindEvents();
    renderCats();
    renderCatSelect();
    renderServices();
    refreshTopLogo();
  }

  function normalizeDB(){
    DB.seo = DB.seo || {};
    DB.ui = DB.ui || {logo:""};
    DB.categories = DB.categories || [];
    DB.services = DB.services || [];
  }

  function bindEvents(){
    $("saveDraft").onclick = ()=>{
      syncFromUI();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(DB));
      alert("Yadda saxlandı.");
    };

    $("loadFromSite").onclick = async ()=>{
      try{
        const res = await fetch("services.json?v=" + Date.now(), {cache:"no-store"});
        if(!res.ok) throw new Error("Oxunmadı");
        DB = await res.json();
        normalizeDB();
        fillUI();
        renderCats(); renderCatSelect(); renderServices();
        refreshTopLogo();
        alert("Saytdan yükləndi.");
      }catch(e){
        alert("Saytdan oxunmadı. services.json saytda (repo kökündə) olmalıdır.");
      }
    };

    $("downloadJson").onclick = ()=>{
      syncFromUI();
      const blob = new Blob([JSON.stringify(DB, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "services.json";
      a.click();
      URL.revokeObjectURL(a.href);
    };

    $("addCat").onclick = ()=>{
      const key = ($("cat_key").value || "").trim().toLowerCase();
      const label = ($("cat_label").value || "").trim();
      if(!key || !label) return alert("Key və label doldur.");
      if(DB.categories.some(c=>c.key===key)) return alert("Bu key artıq var.");
      DB.categories.push({key,label});
      $("cat_key").value=""; $("cat_label").value="";
      renderCats(); renderCatSelect();
    };

    $("addService").onclick = ()=>{
      syncFromUI();
      const s = collectServiceFromForm();
      if(!s) return;
      if(DB.services.some(x=>x.id===s.id)) return alert("Bu ID artıq var.");
      DB.services.push(s);
      clearServiceForm();
      renderServices();
    };

    $("clearForm").onclick = ()=> clearServiceForm();

    $("s_img_file").addEventListener("change", async (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      $("s_img").value = await fileToDataURL(f);
    });

    $("ui_logo_file").addEventListener("change", async (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      $("ui_logo").value = await fileToDataURL(f);
      refreshTopLogo();
    });

    $("favicon_file").addEventListener("change", async (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      $("seo_favicon").value = await fileToDataURL(f);
    });

    $("og_file").addEventListener("change", async (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      $("seo_og").value = await fileToDataURL(f);
    });

    $("ui_logo").addEventListener("input", refreshTopLogo);
  }

  function fillUI(){
    $("brand").value = DB.brand || "";
    $("wa").value = DB.whatsapp || "";
    $("ui_logo").value = (DB.ui && DB.ui.logo) ? DB.ui.logo : "";

    const seo = DB.seo || {};
    $("seo_title").value = seo.title || "";
    $("seo_desc").value = seo.description || "";
    $("seo_canon").value = seo.canonical || "";
    $("seo_theme").value = seo.theme_color || "#070707";
    $("seo_favicon").value = seo.favicon || "";
    $("seo_og").value = seo.og_image || "";
  }

  function syncFromUI(){
    DB.brand = ($("brand").value || "").trim();
    DB.whatsapp = ($("wa").value || "").trim();

    DB.ui = DB.ui || {};
    DB.ui.logo = ($("ui_logo").value || "").trim();

    DB.seo = DB.seo || {};
    DB.seo.title = ($("seo_title").value || "").trim();
    DB.seo.description = ($("seo_desc").value || "").trim();
    DB.seo.canonical = ($("seo_canon").value || "").trim();
    DB.seo.theme_color = ($("seo_theme").value || "").trim() || "#070707";
    DB.seo.favicon = ($("seo_favicon").value || "").trim();
    DB.seo.og_image = ($("seo_og").value || "").trim();
    DB.seo.site_name = DB.brand || "Mirpanel.com";
    DB.seo.twitter_card = "summary_large_image";
  }

  function refreshTopLogo(){
    const url = ($("ui_logo")?.value || DB?.ui?.logo || "").trim();
    const img = $("topLogo");
    if(url){
      img.src = url;
      img.style.display = "block";
    }else{
      img.style.display = "none";
    }
  }

  function renderCats(){
    const el = $("catList");
    el.innerHTML = "";
    (DB.categories || []).forEach((c, idx)=>{
      const d = document.createElement("div");
      d.className = "item";
      d.innerHTML = `
        <div>
          <div class="k">Key</div>
          <input value="${esc(c.key)}" data-i="${idx}" data-f="key">
          <div class="k" style="margin-top:6px">Label</div>
          <input value="${esc(c.label)}" data-i="${idx}" data-f="label">
        </div>
        <div class="mini">
          <button data-act="up" data-i="${idx}">Yuxarı</button>
          <button data-act="down" data-i="${idx}">Aşağı</button>
          <button class="danger" data-act="del" data-i="${idx}">Sil</button>
        </div>
      `;
      el.appendChild(d);
    });

    el.querySelectorAll("input").forEach(inp=>{
      inp.addEventListener("input", ()=>{
        const i = +inp.dataset.i;
        const f = inp.dataset.f;
        DB.categories[i][f] = inp.value;
        renderCatSelect();
      });
    });

    el.querySelectorAll("button").forEach(b=>{
      b.onclick = ()=>{
        const i = +b.dataset.i;
        const act = b.dataset.act;
        if(act==="del"){
          if(!confirm("Kateqoriya silinsin?")) return;
          DB.categories.splice(i,1);
          renderCats(); renderCatSelect(); renderServices();
        }
        if(act==="up" && i>0){
          [DB.categories[i-1],DB.categories[i]]=[DB.categories[i],DB.categories[i-1]];
          renderCats(); renderCatSelect();
        }
        if(act==="down" && i<DB.categories.length-1){
          [DB.categories[i+1],DB.categories[i]]=[DB.categories[i],DB.categories[i+1]];
          renderCats(); renderCatSelect();
        }
      };
    });
  }

  function renderCatSelect(){
    const sel = $("s_cat");
    sel.innerHTML = "";
    (DB.categories || []).forEach(c=>{
      const o = document.createElement("option");
      o.value = c.key;
      o.textContent = c.label;
      sel.appendChild(o);
    });
  }

  function collectServiceFromForm(){
    const category = ($("s_cat").value || "").trim();
    const id = ($("s_id").value || "").trim();
    const title = ($("s_title").value || "").trim();
    const amount = ($("s_amount").value || "").trim();
    const currency = ($("s_cur").value || "AZN").trim();
    const image = ($("s_img").value || "").trim();
    const price = Number(($("s_price").value || "").trim());
    const oldRaw = ($("s_old").value || "").trim();

    if(!category || !id || !title || !amount || !image || !Number.isFinite(price)){
      alert("Kateqoriya, ID, ad, miqdar, qiymət və şəkil mütləqdir.");
      return null;
    }

    const s = {
      id, category, title, amount,
      price, currency,
      image,
      desc: ($("s_desc").value || "").trim(),
      guarantee: ($("s_gua").value || "").trim(),
      speed: ($("s_speed").value || "").trim(),
      note: ($("s_note").value || "").trim()
    };
    if(oldRaw !== "" && !isNaN(Number(oldRaw))) s.price_old = Number(oldRaw);
    return s;
  }

  function clearServiceForm(){
    $("s_id").value="";
    $("s_title").value="";
    $("s_amount").value="1000 Ədəd";
    $("s_price").value="";
    $("s_old").value="";
    $("s_desc").value="";
    $("s_gua").value="";
    $("s_speed").value="";
    $("s_note").value="";
    $("s_img").value="";
    $("s_img_file").value="";
    $("s_cur").value="AZN";
  }

  function renderServices(){
    const el = $("serviceList");
    el.innerHTML = "";

    (DB.services || []).forEach((s, idx)=>{
      const d = document.createElement("div");
      d.className = "item";
      d.innerHTML = `
        <div>
          <div class="mini" style="justify-content:space-between">
            <div class="mini">
              <img class="thumb" src="${esc(s.image || "")}" alt="">
              <div>
                <div style="font-weight:900">${esc(s.title || "")}</div>
                <div class="k">${esc(s.category || "")} • ${esc(s.amount || "")} • ${esc(s.price)} ${esc(s.currency || "AZN")}</div>
                <div class="k">${esc(s.id || "")}</div>
              </div>
            </div>
          </div>

          <div class="split" style="margin-top:8px">
            <div>
              <label>Ad</label>
              <input value="${esc(s.title || "")}" data-i="${idx}" data-f="title">
            </div>
            <div>
              <label>Miqdar</label>
              <input value="${esc(s.amount || "")}" data-i="${idx}" data-f="amount">
            </div>
          </div>

          <div class="split">
            <div>
              <label>Qiymət</label>
              <input value="${esc(s.price)}" data-i="${idx}" data-f="price">
            </div>
            <div>
              <label>Köhnə qiymət</label>
              <input value="${esc(s.price_old ?? "")}" data-i="${idx}" data-f="price_old">
            </div>
          </div>

          <div class="split">
            <div>
              <label>Zəmanət</label>
              <input value="${esc(s.guarantee || "")}" data-i="${idx}" data-f="guarantee">
            </div>
            <div>
              <label>İcra</label>
              <input value="${esc(s.speed || "")}" data-i="${idx}" data-f="speed">
            </div>
          </div>

          <label>Şəkil URL</label>
          <input value="${esc(s.image || "")}" data-i="${idx}" data-f="image">

          <label>Açıqlama</label>
          <textarea data-i="${idx}" data-f="desc">${esc(s.desc || "")}</textarea>

          <label>Şərt/Qeyd</label>
          <textarea data-i="${idx}" data-f="note">${esc(s.note || "")}</textarea>
        </div>

        <div class="mini">
          <button data-act="up" data-i="${idx}">Yuxarı</button>
          <button data-act="down" data-i="${idx}">Aşağı</button>
          <button class="danger" data-act="del" data-i="${idx}">Sil</button>
        </div>
      `;
      el.appendChild(d);
    });

    el.querySelectorAll("input,textarea").forEach(inp=>{
      inp.addEventListener("input", ()=>{
        const i = +inp.dataset.i;
        const f = inp.dataset.f;

        if(f==="price" || f==="price_old"){
          const raw = (inp.value || "").trim();
          if(raw === ""){
            if(f==="price_old") delete DB.services[i].price_old;
            return;
          }
          const n = Number(raw);
          if(Number.isNaN(n)) return;
          if(f==="price") DB.services[i].price = n;
          else DB.services[i].price_old = n;
          return;
        }

        DB.services[i][f] = inp.value;
      });
    });

    el.querySelectorAll("button").forEach(b=>{
      b.onclick = ()=>{
        const i = +b.dataset.i;
        const act = b.dataset.act;
        if(act==="del"){
          if(!confirm("Xidmət silinsin?")) return;
          DB.services.splice(i,1);
          renderServices();
        }
        if(act==="up" && i>0){
          [DB.services[i-1],DB.services[i]]=[DB.services[i],DB.services[i-1]];
          renderServices();
        }
        if(act==="down" && i<DB.services.length-1){
          [DB.services[i+1],DB.services[i]]=[DB.services[i],DB.services[i+1]];
          renderServices();
        }
      };
    });
  }

  function fileToDataURL(file){
    return new Promise((resolve, reject)=>{
      const r = new FileReader();
      r.onload = ()=> resolve(String(r.result));
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }

  gate();
</script>
</body>
</html>